信息抽取的模型

任务：支持实体识别（不同类型实体的嵌套，同一类实体的非连续），支持关系抽取（有方向的关系，多条关系，非连续实体的关系），支持事件抽取（同关系抽取），支持属性抽取（同关系抽取）

本质：从某个角度抽取文本中的一些子片段，抽象为若干个节点的最大团选择（团：各个节点都有连线），两个最大团通过连接变成一个更大团，这些连接可以抽象为关系，若干个节点是否有连接实例化为链接矩阵，上下三角可以表示链接方向，值可以表示权重

具体操作：
- 实体识别：用一张图表示一个实体类型，上面有这个类型的所有实体，最大团表示一个实体（包括非连续，这个非连续默认是且关系，无向，如果需要方向，请使用关系抽取），仅使用上三角
- 关系抽取：用两张图表示一种关系，一张图表示这种关系中涉及到的各个实体，在上三角，这些实体可能是各种类型，一张图表示各个实体的关系，如果有链接方向，则使用下三角，先解析存在的表示关系的最大矩阵(上下文)，再对于每个关系，通过识别到的实体进行限制（实体浅层信息），最后得到确定的实体和关系


注意：且关系用实体识别，如果或关系，分成两个实体

- 原始数据：输入：一段文本（input_text），一些特征（features）,若有label：则写label,实体识别使用一个NER+实体类型作为key，里面是list，每个list里面是一个实体，每个实体可能有若干个part；关系抽取，使用RELATION+关系类型作为key，里面是一个list，每个list表示一条关系，list里面是一个dict，里面保存关系里面的各个实体，里面固定relation的key表示用到的具体关系，
```
{
'input_text':'',
'NER_name':[
    [{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''}],
    [{'start_offset':'','end_offset':'','text':''}],
 ]
'RELATION_name':[
    {
        'entity_type_1':[{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''}],
        'entity_type_2':[{'start_offset':'','end_offset':'','text':''}],
        'entity_type_3':[{'start_offset':'','end_offset':'','text':''}],
        'relation':['entity_type_1','entity_type_3','entity_type_2]
    },
    {
        'entity_type_4':[{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''}],
        'entity_type_3':[{'start_offset':'','end_offset':'','text':''}],
        'relation':['entity_type_4','entity_type_3']
    }

    ],
'features':{'raw':''}
} 
```
- 评估数据：对原始数据进行变换，用字符串表示唯一实体，用|表示实体不同片段的链接，虽然实体无序，但评估时要进行排序，关系抽取里面的实体用[]表示，一个样本中多个实体或关系用set表示
```
[{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''}] 
---> 'entity_type,start_offset,end_offset,text|start_offset,end_offset,text'

{'entity_type_4':[{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''},{'start_offset':'','end_offset':'','text':''}],'entity_type_3':[{'start_offset':'','end_offset':'','text':''}],'relation':['entity_type_4','entity_type_3']}  
--->'relation_type,[start_offset,end_offset,text|start_offset,end_offset,text]---[start_offset,end_offset,text]'

```


###########

怎么构建一个模型？
1. 先确定原始数据，换成标准数据格式（预先定义好的）
2. 定义模型的流程，填补架构，首先forward，然后loss，然后metic
3. 固定模型的输入输出，把标准数据格式转为模型输入输出格式
#############
信息抽取模型，支持ner和relation和span_extraction

使用矩阵作为模型的输出，一个矩阵可以复现成一张图，图中包含各种信息，

实体识别：如果无论连续还是不连续实体，直接一张图，取上三角矩阵，对角线表示该点是否是一个单独实体，其余上三角点表示点和点的连线，通过连在一起的上三角复现出原始图--使用极大团解析，解析出来的团，所以实体的点数一定是，1，3，6，10, n(n+1)/2 其中n为包含的节点数，此时后处理要在图上做，看看需不需要去除后保留边，边其实是概率权重，可以通过权重来过滤或确定极大团，

**一张图放一种实体类型**，**同种实体类型的不同实体不会嵌套**（包含关系，A是一个实体，AB是同一类型的实体，只能说B是A的补充使得A更具体，标注时部分作为实体本体，部分作为实体补充（这些补充可能是其他各种类型的实体，可以统一当成补充属性），比如lung+cancer，可以把cancer当成基本疾病，lung当成它的补充（器官），再比如上海市公安局分局，把上海市当作疾病地点，把公安局分局当作补充（机构），实际标注的时候就看需要什么细粒度的，是实体本身还是带各种补充属性的实体，看是否需要区分这些属性，比如疾病需要区分器官还是分期之类的，如果只需要抽带属性的实体，就全部抽取出来，看设计），**只会交叉**（这里的交叉一般指实体+属性补充的交叉，比如lung，breast cancer，这种情况是只想抽取单种具体属性的实体，不想抽取混合属性的实体，实体中只有且关系，或关系用不同实体表现），**实体间默认无序，因为是且关系，不是指向关系，用1表示**

非连续实体间不应该有方向，

一类实体类型识别一类实体，一张图

关系抽取：还是一张图，用1表示的极大团为各个实体，同时创建另一张图构建关系的图，每个实体用一个点或两个点表示，多个实体的关系是最大团，构架关系的图：ss，ee，s|e(一个实体的开头和结尾)和他们的互相组合，因为有向，所以不是上三角矩阵，相当于在原始最大团上，对于每条边打上一个tag,后面优化可以把他们放到一张图：

关系和实体要相互限制和联系起来，就需要一个输出的内容中同时包含这两个隐含信息，也就是一张表同时体现实体和关系，理论上这张表是由两张表组合起来，一张是实体的表，其中每个矩阵点表示连接，最大团表示一个实体（非连续实体也不需要考虑关系），一张是关系的表，这个不同于实体，应该使用下三角部分表示逆向的关系方向，所以整个的tag应该是：s-s，e-e，s-e

**一张图放一个维度的关系，但这些关系可以有多个类型的实体，比如靶点-》疾病-》药物**，**所以这些不同实体形成的关系不能交叉**，不同实体间有连接，这种连接是带指向的，所以一张图中，相同实体部分用1表示连接，不同实体部分用2表示连接，为了使用上三角矩阵，反向连接用3表示，注意，最好只保留出现在关系中的实体，不能把所有实体抽取出来，用实体都抽取来用实体识别，因为我们只能抽取实体，不能指证实体的类型，**只抽关系用一张图，既抽关系又抽实体类型需要两张图**，理论上可以把这两个放到一起，但是否会有冲突以及tag的排列选择

构建模型的时候：有几个实体，构建几张图，有几个关系，构建几个关系的图，最后处理的时候，把关系和实体进行互相约束处理





